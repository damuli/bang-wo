<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡¹ğŸ‡¼ å°ç£è¯èª RPGï¼šå¹«æˆ‘å‚³èªª (Audio Ver.)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            background-color: #1a1a1a;
            color: #fff;
            font-family: 'DotGothic16', 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            flex-direction: column;
        }

        /* éŠæˆ²é–‹ç™¼è€… Credit */
        .developer-credit {
            margin-top: 20px;
            color: #888;
            font-size: 1.2rem;
            letter-spacing: 2px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
            animation: glow 3s infinite alternate;
        }

        @keyframes glow {
            from { color: #888; }
            to { color: #fff; text-shadow: 0 0 10px #0f0; }
        }

        .scanlines {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        .game-boy {
            width: 800px;
            height: 600px;
            background-color: #000;
            border: 6px solid #555;
            border-radius: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(0,255,0,0.15);
            overflow: hidden;
        }

        /* å•Ÿå‹•é®ç½© (ç‚ºäº†è§£é–éŸ³æ•ˆ) */
        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.5s;
        }

        #start-overlay h1 {
            color: #0f0;
            font-size: 3em;
            text-shadow: 4px 4px 0 #005500;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        .scene-display {
            flex: 2;
            background-size: cover;
            background-position: center;
            position: relative;
            border-bottom: 4px solid #fff;
            image-rendering: pixelated;
            transition: background-image 0.5s ease;
        }
        
        .npc-sprite {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            font-size: 150px;
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
            animation: float 3s infinite ease-in-out;
        }

        .status-bar {
            background: #222;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #555;
            font-size: 1.2em;
            color: #0f0;
        }

        .dialogue-box {
            flex: 1;
            padding: 20px;
            background: #000;
            color: #fff;
            font-size: 1.4em;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .typing-text::after {
            content: 'â–‹';
            animation: blink 0.8s infinite;
            color: #0f0;
        }

        .choices-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .rpg-btn {
            background: #000;
            border: 2px solid #fff;
            color: #fff;
            padding: 15px;
            font-family: inherit;
            font-size: 1em;
            cursor: pointer;
            text-align: left;
            transition: 0.2s;
        }

        .rpg-btn:hover {
            background: #fff;
            color: #000;
            border-color: #0f0;
        }

        .ending-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            text-align: center;
        }
        
        .ending-title {
            font-size: 3em;
            margin-bottom: 20px;
            color: #f1c40f;
            text-shadow: 4px 4px 0 #c0392b;
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes float { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-15px); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

    </style>
</head>
<body>
    <div class="scanlines"></div>
    
    <div class="game-boy">
        <div id="start-overlay" onclick="startGame()">
            <h1>é»æ“Šç•«é¢é–‹å§‹éŠæˆ²</h1>
            <p style="color: #fff; font-size: 1.5em;">(Click to Start & Enable Audio)</p>
            <p style="color: #888; margin-top: 20px;">è«‹é–‹å•ŸéŸ³æ•ˆä»¥ç²å¾—æœ€ä½³é«”é©—</p>
        </div>

        <div class="status-bar">
            <div>LV. <span id="level">1</span> å¤–åœ‹å­¸ç”Ÿ</div>
            <div>HP: <span id="hp">100</span>/100</div>
            <div>EXP: <span id="exp">0</span></div>
        </div>

        <div class="scene-display" id="scene-bg" style="background-image: url('https://images.unsplash.com/photo-1554118811-1e0d58224f24?q=80&w=1000');">
            <div class="npc-sprite" id="npc-emoji">ğŸ¥¤</div>
        </div>

        <div class="dialogue-box">
            <div id="story-text" class="typing-text">ç­‰å¾…å•Ÿå‹•ä¸­...</div>
            <div class="choices-container" id="choices-area"></div>
        </div>

        <div class="ending-screen" id="ending-layer">
            <h1 class="ending-title" id="ending-title">çµå±€</h1>
            <p id="ending-desc" style="font-size: 1.5em; max-width: 80%; margin-bottom: 30px;"></p>
            <button class="rpg-btn" onclick="location.reload()" style="width: 200px; text-align: center;">é‡æ–°å†’éšª</button>
        </div>

        <audio id="bgm" loop>
            <source src="https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/theme_01.mp3" type="audio/mp3">
        </audio>
    </div>

    <div class="developer-credit">éŠæˆ²é–‹ç™¼ï¼šæ—é´»ç‘è€å¸«</div>

<script>
    // === éŸ³æ•ˆåˆæˆå™¨ (Web Audio API) ===
    // é€™æ¨£å°±ä¸éœ€è¦ä¸‹è¼‰éŸ³æ•ˆæª”ï¼Œç¨‹å¼ç¢¼æœƒè‡ªå·±ç”¢ç”Ÿå¾©å¤éŸ³æ•ˆ
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(freq, type, duration) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    const SFX = {
        type: () => playTone(800 + Math.random()*200, 'square', 0.05), // æ‰“å­—è²
        select: () => playTone(440, 'triangle', 0.1), // é¸æ“‡è²
        correct: () => { // æ­£ç¢ºï¼šä¸Šè¡Œç¶éŸ³
            playTone(523.25, 'square', 0.1); // C
            setTimeout(() => playTone(659.25, 'square', 0.1), 100); // E
            setTimeout(() => playTone(783.99, 'square', 0.2), 200); // G
        },
        wrong: () => { // éŒ¯èª¤ï¼šä½é »é›œè¨Š
            playTone(150, 'sawtooth', 0.4);
            setTimeout(() => playTone(100, 'sawtooth', 0.4), 200);
        }
    };

    // === éŠæˆ²é‚è¼¯ ===
    let hp = 100;
    let exp = 0;
    let currentStep = 0;
    let isTyping = false;

    // å•Ÿå‹•éŠæˆ²
    function startGame() {
        const overlay = document.getElementById('start-overlay');
        overlay.style.opacity = '0';
        setTimeout(() => overlay.style.display = 'none', 500);
        
        // æ’­æ”¾ BGM (éŸ³é‡èª¿å°)
        const bgm = document.getElementById('bgm');
        bgm.volume = 0.3;
        bgm.play().catch(e => console.log("Audio play failed", e));

        renderScene(0);
    }

    // åŠ‡æœ¬ (åŒå‰ç‰ˆ)
    const storyLine = [
        {
            bg: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=1000",
            npc: "âœˆï¸",
            text: "æ­¡è¿ä¾†åˆ°å°ç£ï¼\né€™æ˜¯ä¸€å ´é—œæ–¼ã€Œå¹«æˆ‘ã€çš„ç”Ÿå­˜æŒ‘æˆ°ã€‚\nè«‹æ³¨æ„ä½ çš„ã€Œé¢å­(HP)ã€ï¼Œæ­¸é›¶å°±å°·å°¬å›‰ï¼",
            choices: [{ text: "é–‹å§‹å†’éšª", next: 1, effect: null }]
        },
        {
            bg: "https://images.unsplash.com/photo-1521017432531-fbd92d768814?q=80&w=1000",
            npc: "ğŸ¥¤",
            text: "ã€é£²æ–™åº—ã€‘\nåº—å“¡ï¼šã€Œé£²æ–™å¥½å›‰ï¼å–ä¹‹å‰éº»ç…©å¹«æˆ‘æ–ä¸€ä¸‹å–”ï¼ã€",
            choices: [
                { text: "A. å¥½çš„ (è‡ªå·±æ–é£²æ–™)", next: 2, effect: { hp: 0, exp: 20, msg: "åº—å“¡å¾®ç¬‘ã€‚é€™æ˜¯æ–°å¼æŒ‡ä»¤ï¼" } },
                { text: "B. å¹«åº—å“¡æ–é£²æ–™", next: 2, effect: { hp: -30, exp: 0, msg: "åº—å“¡åš‡åˆ°...ä»–ä¸æ˜¯è¦ä½ å¹«å¿™å•¦ï¼" } }
            ]
        },
        {
            bg: "https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=1000",
            npc: "ğŸ‘©â€âš•ï¸",
            text: "ã€è¨ºæ‰€ã€‘\nè­·ç†å¸«ï¼šã€Œå…ˆç”Ÿæˆ‘å€‘è¦é‡é«”è„‚ï¼Œè«‹å¹«æˆ‘è„«ä¸€ä¸‹è¥ªå­ã€‚ã€",
            choices: [
                { text: "A. å»è„«è­·ç†å¸«çš„è¥ªå­", next: 3, effect: { hp: -60, exp: 0, msg: "è®Šæ…‹ï¼è­·ç†å¸«å°–å«ï¼é¢å­å¤§æï¼" } },
                { text: "B. è„«è‡ªå·±çš„è¥ªå­", next: 3, effect: { hp: 0, exp: 30, msg: "æ­£ç¢ºï¼é€™æ˜¯ç‚ºäº†æ–¹ä¾¿æµç¨‹é€²è¡Œã€‚" } }
            ]
        },
        {
            bg: "https://images.unsplash.com/photo-1552566626-52f8b828add9?q=80&w=1000",
            npc: "ğŸ½ï¸",
            text: "ã€é¤å»³ã€‘\næœå‹™ç”Ÿï¼šã€Œå‰é¢è«‹å¹«æˆ‘ååœ¨ç¬¬ä¸‰æ¡Œå–”ã€‚ã€",
            choices: [
                { text: "A. æ‰¶æœå‹™ç”Ÿå»å", next: 4, effect: { hp: -50, exp: 0, msg: "æœå‹™ç”Ÿï¼šå…ˆç”Ÿä½ å¹¹å˜›... (å°·å°¬)" } },
                { text: "B. è‡ªå·±å»å", next: 4, effect: { hp: 0, exp: 20, msg: "å…§è¡Œï¼é€™æ˜¯å ´åŸŸå”èª¿çš„ç¦®è²Œç”¨æ³•ã€‚" } }
            ]
        },
        {
            bg: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?q=80&w=1000",
            npc: "ğŸ‘µ",
            text: "ã€è·¯é‚Šã€‘\né˜¿å©†æ¬ç®±å­ï¼šã€Œå¹´è¼•äººï¼Œå¹«æˆ‘æ¬ä¸€ä¸‹å¥½å—ï¼Ÿã€",
            choices: [
                { text: "A. ç«™è‘—ä¸å‹• (ä»¥ç‚ºæ˜¯æŒ‡ä»¤)", next: 99, effect: { hp: -20, exp: 0, msg: "é˜¿å©†ç”Ÿæ°£äº†ï¼é€™æ˜¯çœŸçš„æ±‚åŠ©ï¼" } },
                { text: "B. é¦¬ä¸Šå¹«å¿™", next: 99, effect: { hp: 10, exp: 30, msg: "é˜¿å©†æ„Ÿè¬ä½ ï¼é€™å°±æ˜¯å°ç£äººæƒ…å‘³ï¼" } }
            ]
        }
    ];

    function renderScene(index) {
        if (hp <= 0) { showEnding("bad"); return; }
        if (index === 99) { determineEnding(); return; }

        const data = storyLine[index];
        document.getElementById("scene-bg").style.backgroundImage = `url('${data.bg}')`;
        document.getElementById("npc-emoji").innerText = data.npc;
        document.getElementById("choices-area").innerHTML = "";

        const textBox = document.getElementById("story-text");
        textBox.innerHTML = "";
        let i = 0;
        isTyping = true;

        function typeWriter() {
            if (i < data.text.length) {
                const char = data.text.charAt(i);
                textBox.innerHTML += char === '\n' ? '<br>' : char;
                if(i % 3 === 0) SFX.type(); // æ¯3å€‹å­—ç™¼å‡ºä¸€æ¬¡è²éŸ³ï¼Œé¿å…å¤ªåµ
                i++;
                setTimeout(typeWriter, 50);
            } else {
                isTyping = false;
                renderChoices(data.choices);
            }
        }
        typeWriter();
    }

    function renderChoices(choices) {
        const area = document.getElementById("choices-area");
        choices.forEach(choice => {
            const btn = document.createElement("button");
            btn.className = "rpg-btn";
            btn.innerText = choice.text;
            btn.onmouseenter = () => SFX.select(); // æ»‘é¼ ç¶“ééŸ³æ•ˆ
            btn.onclick = () => handleChoice(choice);
            area.appendChild(btn);
        });
    }

    function handleChoice(choice) {
        if (isTyping) return; // æ‰“å­—ä¸­ä¸èƒ½æŒ‰

        if (choice.effect) {
            hp += choice.effect.hp;
            exp += choice.effect.exp;
            if (hp > 100) hp = 100;
            updateStats();

            if (choice.effect.hp < 0) {
                SFX.wrong(); // ç­”éŒ¯éŸ³æ•ˆ
                alert("âŒ " + choice.effect.msg);
            } else {
                SFX.correct(); // ç­”å°éŸ³æ•ˆ
                if(choice.effect.msg) alert("â­• " + choice.effect.msg);
            }
        }
        renderScene(choice.next);
    }

    function updateStats() {
        const hpEl = document.getElementById("hp");
        hpEl.innerText = hp;
        document.getElementById("exp").innerText = exp;
        if (hp < 50) hpEl.style.color = "#e74c3c";
        else hpEl.style.color = "#0f0";
    }

    function determineEnding() {
        if (exp >= 80) showEnding("master");
        else showEnding("normal");
    }

    function showEnding(type) {
        const screen = document.getElementById("ending-layer");
        const title = document.getElementById("ending-title");
        const desc = document.getElementById("ending-desc");
        screen.style.display = "flex";

        if (type === "master") {
            title.innerText = "ğŸ† å°å‘³å¤§å¸«";
            title.style.color = "#f1c40f";
            desc.innerHTML = "æ—é´»ç‘è€å¸«èªè­‰ï¼š<br>ä½ å·²ç¶“å®Œå…¨æŒæ¡å°ç£è¯èªçš„ç²¾éš¨äº†ï¼";
            SFX.correct();
        } else if (type === "bad") {
            title.innerText = "ğŸ’€ ç¤¾æœƒæ€§æ­»äº¡";
            title.style.color = "#e74c3c";
            desc.innerHTML = "å› ç‚ºèª¤è§£ã€Œå¹«æˆ‘ã€ï¼Œä½ é€ æˆäº†å¤ªå¤§çš„å°·å°¬...<br>è«‹é‡æ–°ä¿®ç·´ï¼";
            SFX.wrong();
        } else {
            title.innerText = "ğŸ˜ æ™®é€šéŠå®¢";
            desc.innerHTML = "é‚„ä¸éŒ¯ï¼Œä½†é‚„æœ‰é€²æ­¥ç©ºé–“ï¼";
        }
    }
</script>
</body>
</html>
