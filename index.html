<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡¹ğŸ‡¼ å°ç£è¯èªå¤§å†’éšªï¼šå¹«æˆ‘å¤§åµæ¢ V2</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #2c3e50;
        }

        /* å‹•æ…‹èƒŒæ™¯å±¤ */
        #bg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(4px) brightness(0.6);
            transition: background-image 0.5s ease-in-out;
            z-index: -1;
        }

        /* éŠæˆ²ä¸»è¦–çª— */
        .game-window {
            width: 90%;
            max-width: 800px;
            height: 85vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            border: 4px solid #fff;
        }

        /* é ‚éƒ¨ç‹€æ…‹åˆ— */
        .status-bar {
            background: #333;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        /* å°å‘³æŒ‡æ•¸è¡€æ¢ */
        .health-container {
            width: 50%;
            background: #555;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #fff;
        }
        .health-bar {
            width: 50%; /* åˆå§‹å€¼ */
            height: 100%;
            background: linear-gradient(90deg, #f1c40f, #e67e22);
            transition: width 0.5s cubic-bezier(0.25, 1, 0.5, 1);
        }

        /* è§’è‰²å€åŸŸ */
        .character-area {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .character-emoji {
            font-size: 150px;
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .character-emoji:hover {
            transform: scale(1.1);
        }

        /* å°è©±æ¡†å€åŸŸ */
        .dialogue-section {
            background: #fff;
            padding: 20px;
            border-top: 4px solid #3498db;
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }

        .name-tag {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            display: inline-block;
            font-weight: 900;
            margin-bottom: 10px;
            align-self: flex-start;
            box-shadow: 2px 2px 0px #2980b9;
        }

        .dialogue-text {
            font-size: 1.3em;
            color: #2c3e50;
            line-height: 1.6;
            margin-bottom: 20px;
            min-height: 60px;
        }

        .keyword {
            color: #e74c3c;
            font-weight: 900;
            font-size: 1.4em;
            background: rgba(231, 76, 60, 0.1);
            padding: 0 5px;
            border-radius: 5px;
        }

        /* é¸é …æŒ‰éˆ• */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .option-btn {
            background: white;
            border: 2px solid #bdc3c7;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            color: #7f8c8d;
            box-shadow: 0 4px 0 #bdc3c7;
        }

        .option-btn:hover {
            border-color: #3498db;
            color: #3498db;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #bdc3c7;
        }

        .option-btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #bdc3c7;
        }

        /* æµ®èª‡çš„å›é¥‹è¦–çª— (Overlay) */
        #feedback-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 100;
            animation: fadeIn 0.3s;
        }

        .feedback-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 70%;
            transform: scale(0.8);
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .feedback-title {
            font-size: 2em;
            margin: 0 0 10px 0;
        }
        .feedback-title.correct { color: #2ecc71; text-shadow: 2px 2px 0 #27ae60;}
        .feedback-title.wrong { color: #e74c3c; text-shadow: 2px 2px 0 #c0392b;}

        .next-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 30px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
            box-shadow: 0 5px 0 #2980b9;
            transition: transform 0.1s;
        }
        .next-btn:active { transform: translateY(3px); box-shadow: none; }

        /* å‹•ç•«ç‰¹æ•ˆ */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        @keyframes popIn {
            to { transform: scale(1); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .shake-effect {
            animation: shake 0.5s;
        }

        /* ç°¡æ˜“å½©å¸¶ Canvas */
        #confetti-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

    </style>
</head>
<body>

    <div id="bg-layer" style="background-image: url('https://images.unsplash.com/photo-1554118811-1e0d58224f24?q=80&w=1000');"></div>

    <div class="game-window" id="game-window">
        <div class="status-bar">
            <span>LEVEL <span id="level-display">1</span></span>
            <div style="display: flex; align-items: center; gap: 10px; width: 60%;">
                <span>ğŸ”¥ å°å‘³æŒ‡æ•¸ (Tai-wei Level):</span>
                <div class="health-container">
                    <div class="health-bar" id="health-bar"></div>
                </div>
            </div>
            <span>SCORE: <span id="score-display">0</span></span>
        </div>

        <div class="character-area">
            <div class="character-emoji" id="char-emoji">ğŸ§‘â€ğŸ³</div>
        </div>

        <div class="dialogue-section">
            <div class="name-tag" id="char-name">åº—å“¡</div>
            <div class="dialogue-text" id="dialogue-text">
                è¼‰å…¥ä¸­...
            </div>
            <div class="options-grid" id="options-area">
                <button class="option-btn" onclick="makeChoice(0)">é¸é … A</button>
                <button class="option-btn" onclick="makeChoice(1)">é¸é … B</button>
            </div>
        </div>

        <div id="feedback-overlay">
            <div class="feedback-card">
                <h2 class="feedback-title" id="feedback-title">æ¨™é¡Œ</h2>
                <div style="font-size: 50px; margin-bottom: 10px;" id="feedback-icon">ğŸ‰</div>
                <p style="font-size: 1.1em; line-height: 1.5; color: #555;" id="feedback-msg">å…§å®¹</p>
                <button class="next-btn" onclick="nextQuestion()">ç¹¼çºŒä¸‹ä¸€é¡Œ âœ</button>
            </div>
        </div>

        <canvas id="confetti-canvas"></canvas>
    </div>

<script>
    // === éŠæˆ²è³‡æ–™åº« (åƒè€ƒè«–æ–‡çœŸå¯¦èªæ–™) ===
    const questions = [
        {
            bg: "https://images.unsplash.com/photo-1521017432531-fbd92d768814?q=80&w=1000", // Coffee Shop
            role: "é£²æ–™åº—åº—å“¡ (Clerk)",
            emoji: "ğŸ¥¤",
            text: "é£²æ–™å¥½å›‰ï¼å–ä¹‹å‰å†<span class='keyword'>å¹«æˆ‘</span>æ–ä¸€ä¸‹å–”ï¼",
            choices: [
                { text: "æˆ‘å¹«åº—å“¡æ–é£²æ–™ (Shake for clerk)", type: "wrong" },
                { text: "æˆ‘è‡ªå·±æ–æˆ‘è‡ªå·±çš„é£²æ–™ (Shake my own)", type: "correct" }
            ],
            correctMsg: "æ²’éŒ¯ï¼åº—å“¡æ‰ä¸æƒ³å–ä½ çš„é£²æ–™å‘¢ ğŸ˜‚ã€‚<br>é€™æ˜¯æœå‹™æ¥­çš„ã€Œå®¢æ°£æŒ‡ä»¤ã€ã€‚",
            wrongMsg: "å°·å°¬äº†ï¼åº—å“¡ç”¨å¥‡æ€ªçš„çœ¼ç¥çœ‹è‘—ä½ ...<br>ä»–å…¶å¯¦åªæ˜¯è¦ä½ è‡ªå·±æ–ä¸€æ–å•¦ï¼"
        },
        {
            bg: "https://images.unsplash.com/photo-1512917774080-9991f1c4c750?q=80&w=1000", // Living Room
            role: "å—å‚·çš„å…’å­ (Son)",
            emoji: "ğŸ¤•",
            text: "åª½ï¼Œæˆ‘çš„è…³å¥½ç—›ï¼Œè«‹<span class='keyword'>å¹«æˆ‘</span>è„«ä¸€ä¸‹è¥ªå­ã€‚",
            choices: [
                { text: "åª½åª½å¹«å…’å­è„«è¥ªå­ (Help him)", type: "correct" },
                { text: "åª½åª½è„«æ‰è‡ªå·±çš„è¥ªå­ (Take off own)", type: "wrong" }
            ],
            correctMsg: "æ­£ç¢ºï¼é€™æ˜¯å‚³çµ±çš„ã€Œè«‹æ±‚å”åŠ©ã€ã€‚<br>å› ç‚ºå…’å­å—å‚·äº†ï¼Œæ˜¯çœŸçš„éœ€è¦å¹«å¿™ï¼",
            wrongMsg: "ç­‰ç­‰ï¼åª½åª½ç‚ºä»€éº¼è¦è„«è‡ªå·±çš„è¥ªå­ï¼Ÿ<br>é€™æ™‚å€™æ˜¯çœŸçš„éœ€è¦å¹«å¿™å•¦ï¼ğŸ˜‚"
        },
        {
            bg: "https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=1000", // Hospital/Clinic
            role: "è­·ç†å¸« (Nurse)",
            emoji: "ğŸ‘©â€âš•ï¸",
            text: "å…ˆç”Ÿä½ å¥½ï¼Œæˆ‘å€‘è¦é‡é«”è„‚å›‰ï¼Œè«‹<span class='keyword'>å¹«æˆ‘</span>è„«ä¸€ä¸‹è¥ªå­ã€‚",
            choices: [
                { text: "æˆ‘å¹«è­·ç†å¸«è„«è¥ªå­ (Help nurse)", type: "wrong" },
                { text: "æˆ‘è„«è‡ªå·±çš„è¥ªå­ (Take off mine)", type: "correct" }
            ],
            correctMsg: "å¤ªå¼·äº†ï¼ä½ æ‡‚å°ç£çš„æ½›è¦å‰‡ã€‚<br>é€™æ˜¯ç‚ºäº†æµç¨‹é †æš¢ï¼Œè«‹ä½ è‡ªå·±é…åˆè„«è¥ªå­ã€‚",
            wrongMsg: "è­¦å¯Ÿå”å”ï¼å°±æ˜¯é€™å€‹äººï¼ğŸš¨<br>ä½ å»è„«è­·ç†å¸«çš„è¥ªå­æœƒè¢«æŠ“èµ°çš„ï¼é€™æ˜¯å®¢æ°£çš„æŒ‡ä»¤ï¼"
        },
        {
            bg: "https://images.unsplash.com/photo-1552566626-52f8b828add9?q=80&w=1000", // Restaurant
            role: "é¤å»³å¸¶ä½å“¡ (Waiter)",
            emoji: "ğŸ½ï¸",
            text: "å…©ä½å—ï¼Ÿå‰é¢è«‹<span class='keyword'>å¹«æˆ‘</span>ååœ¨ç¬¬ä¸‰æ¡Œå–”ã€‚",
            choices: [
                { text: "æˆ‘èµ°åˆ°ç¬¬ä¸‰æ¡Œåä¸‹ä¾† (Go sit)", type: "correct" },
                { text: "æˆ‘å¹«æœå‹™ç”Ÿååœ¨é‚£é‚Š (Help waiter sit)", type: "wrong" }
            ],
            correctMsg: "Bingo! é€™æ˜¯ã€Œå ´åŸŸå”èª¿å‹ã€çš„å¹«æˆ‘ã€‚<br>è½èµ·ä¾†æ¯”ã€Œè«‹å»åé‚£é‚Šã€æ›´æœ‰ç¦®è²Œå°å§ï¼Ÿ",
            wrongMsg: "æœå‹™ç”Ÿé‚„åœ¨ä¸Šç­ï¼Œä¸èƒ½åå•¦ï¼ğŸ˜…<br>ä»–æ˜¯è«‹ä½ è‡ªå·±å»åé‚£å€‹ä½å­ã€‚"
        },
        {
             bg: "https://images.unsplash.com/photo-1556740738-b6a63e27c4df?q=80&w=1000", // Cashier
             role: "çµå¸³åº—å“¡ (Cashier)",
             emoji: "ğŸ’³",
             text: "é€™å¼µå¡ç‰‡æ„Ÿæ‡‰ä¸åˆ°è€¶ï¼Œ<span class='keyword'>å¹«æˆ‘</span>æ’å¡è©¦è©¦çœ‹ã€‚",
             choices: [
                 { text: "æˆ‘æ‹¿åº—å“¡çš„å¡ç‰‡æ’ (Insert clerk's card)", type: "wrong" },
                 { text: "æˆ‘æŠŠæˆ‘çš„å¡ç‰‡æ’é€²å» (Insert my card)", type: "correct" }
             ],
             correctMsg: "å®Œå…¨æ­£ç¢ºï¼é€™æ˜¯æŒ‡ä»¤ã€‚<br>åº—å“¡å¸Œæœ›ä½ è‡ªå·±æ“ä½œåˆ·å¡æ©Ÿã€‚",
             wrongMsg: "åº—å“¡æ²’æœ‰è¦çµ¦ä½ ä»–çš„å¡ç‰‡å•¦ï¼<br>ä»–æ˜¯è«‹ä½ è‡ªå·±æ“ä½œä½ çš„å¡ç‰‡ã€‚"
        }
    ];

    // === éŠæˆ²ç‹€æ…‹ ===
    let currentQIndex = 0;
    let score = 0;
    let health = 50; // å°å‘³æŒ‡æ•¸åˆå§‹å€¼
    let isGameOver = false;

    // === åˆå§‹åŒ– ===
    function initGame() {
        score = 0;
        health = 50;
        currentQIndex = 0;
        updateStats();
        loadQuestion();
        document.getElementById("end-screen")?.remove();
    }

    // === è¼‰å…¥é¡Œç›® ===
    function loadQuestion() {
        if (currentQIndex >= questions.length) {
            gameWin();
            return;
        }

        const q = questions[currentQIndex];
        
        // æ›´æ–°æ–‡å­—
        document.getElementById("level-display").innerText = currentQIndex + 1;
        document.getElementById("char-name").innerText = q.role;
        document.getElementById("char-emoji").innerText = q.emoji;
        document.getElementById("dialogue-text").innerHTML = `ã€Œ${q.text}ã€`;
        
        // æ›´æ–°èƒŒæ™¯ (æ·¡å…¥æ·¡å‡º)
        const bgLayer = document.getElementById("bg-layer");
        bgLayer.style.opacity = 0;
        setTimeout(() => {
            bgLayer.style.backgroundImage = `url('${q.bg}')`;
            bgLayer.style.opacity = 1;
        }, 500);

        // æ›´æ–°æŒ‰éˆ• (éš¨æ©Ÿé †åº)
        const btnArea = document.getElementById("options-area");
        btnArea.innerHTML = "";
        
        // ç°¡å–®æ´—ç‰Œ
        let shuffledChoices = [...q.choices].sort(() => Math.random() - 0.5);

        shuffledChoices.forEach(choice => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.innerText = choice.text;
            btn.onclick = () => handleAnswer(choice.type, choice.text);
            btnArea.appendChild(btn);
        });
    }

    // === è™•ç†å›ç­” ===
    function handleAnswer(type, text) {
        const overlay = document.getElementById("feedback-overlay");
        const title = document.getElementById("feedback-title");
        const msg = document.getElementById("feedback-msg");
        const icon = document.getElementById("feedback-icon");
        const q = questions[currentQIndex];

        overlay.style.display = "flex";

        if (type === "correct") {
            // ç­”å°é‚è¼¯
            score += 100;
            health = Math.min(100, health + 20); // åŠ è¡€
            title.innerText = "å¤ªå¼·äº†ï¼é“åœ°å°å‘³ï¼";
            title.className = "feedback-title correct";
            msg.innerHTML = q.correctMsg;
            icon.innerText = "ğŸ¤©";
            startConfetti(); // å™´å½©å¸¶
        } else {
            // ç­”éŒ¯é‚è¼¯
            health = Math.max(0, health - 30); // æ‰£è¡€
            title.innerText = "å°·å°¬äº†...åº—å“¡å‚»çœ¼";
            title.className = "feedback-title wrong";
            msg.innerHTML = q.wrongMsg;
            icon.innerText = "ğŸ¥¶";
            
            // ç•«é¢éœ‡å‹•ç‰¹æ•ˆ
            const gameWindow = document.getElementById("game-window");
            gameWindow.classList.add("shake-effect");
            setTimeout(() => gameWindow.classList.remove("shake-effect"), 500);
        }

        updateStats();
    }

    // === æ›´æ–°ç‹€æ…‹æ¢ ===
    function updateStats() {
        document.getElementById("score-display").innerText = score;
        const bar = document.getElementById("health-bar");
        bar.style.width = health + "%";
        
        // è¡€é‡é¡è‰²è®ŠåŒ–
        if (health > 70) bar.style.background = "linear-gradient(90deg, #2ecc71, #27ae60)";
        else if (health > 30) bar.style.background = "linear-gradient(90deg, #f1c40f, #e67e22)";
        else bar.style.background = "linear-gradient(90deg, #e74c3c, #c0392b)";

        if (health <= 0) {
            gameOver();
        }
    }

    // === ä¸‹ä¸€é¡Œ ===
    function nextQuestion() {
        document.getElementById("feedback-overlay").style.display = "none";
        stopConfetti();
        if (!isGameOver) {
            currentQIndex++;
            loadQuestion();
        }
    }

    // === éŠæˆ²çµæŸ (å¤±æ•—) ===
    function gameOver() {
        isGameOver = true;
        const overlay = document.getElementById("feedback-overlay");
        overlay.style.display = "flex";
        document.getElementById("feedback-title").innerText = "éŠæˆ²çµæŸ";
        document.getElementById("feedback-title").className = "feedback-title wrong";
        document.getElementById("feedback-icon").innerText = "ğŸ˜­";
        document.getElementById("feedback-msg").innerHTML = "ä½ çš„å°å‘³æŒ‡æ•¸æ­¸é›¶äº†ï¼<br>åº—å“¡å·²ç¶“ä¸çŸ¥é“è©²æ€éº¼è·Ÿä½ æºé€šäº†...<br>å†è©¦ä¸€æ¬¡å§ï¼";
        
        // æ›´æ”¹æŒ‰éˆ•è¡Œç‚º
        const nextBtn = document.querySelector(".next-btn");
        nextBtn.innerText = "é‡æ–°é–‹å§‹ â†º";
        nextBtn.onclick = () => location.reload();
    }

    // === éŠæˆ²é€šé—œ (å‹åˆ©) ===
    function gameWin() {
        isGameOver = true;
        const overlay = document.getElementById("feedback-overlay");
        overlay.style.display = "flex";
        document.getElementById("feedback-title").innerText = "æ­å–œé€šé—œï¼";
        document.getElementById("feedback-title").className = "feedback-title correct";
        document.getElementById("feedback-icon").innerText = "ğŸ†";
        document.getElementById("feedback-msg").innerHTML = `ä½ çš„æœ€çµ‚å¾—åˆ†ï¼š${score}<br>ä½ å·²ç¶“å®Œå…¨æŒæ¡å°ç£æœå‹™æ¥­çš„æ½›è¦å‰‡äº†ï¼<br>ç¾åœ¨å»è²·çç å¥¶èŒ¶çµ•å°æ²’å•é¡Œï¼`;
        
        startConfetti();
        const nextBtn = document.querySelector(".next-btn");
        nextBtn.innerText = "å†ç©ä¸€æ¬¡ â†º";
        nextBtn.onclick = () => location.reload();
    }

    // === ç°¡æ˜“å½©å¸¶ç‰¹æ•ˆç³»çµ± (Confetti) ===
    const canvas = document.getElementById("confetti-canvas");
    const ctx = canvas.getContext("2d");
    let confettiParticles = [];
    let animationId = null;

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function startConfetti() {
        if (animationId) return;
        for (let i = 0; i < 100; i++) {
            confettiParticles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height - canvas.height,
                color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                size: Math.random() * 10 + 5,
                speedY: Math.random() * 3 + 2,
                speedX: Math.random() * 2 - 1
            });
        }
        animateConfetti();
    }

    function stopConfetti() {
        cancelAnimationFrame(animationId);
        animationId = null;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confettiParticles = [];
    }

    function animateConfetti() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        confettiParticles.forEach((p, index) => {
            p.y += p.speedY;
            p.x += p.speedX;
            ctx.fillStyle = p.color;
            ctx.fillRect(p.x, p.y, p.size, p.size);
            if (p.y > canvas.height) p.y = -10;
        });
        animationId = requestAnimationFrame(animateConfetti);
    }

    // å•Ÿå‹•éŠæˆ²
    initGame();

</script>
</body>
</html>
