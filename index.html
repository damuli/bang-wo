<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ‡¹ğŸ‡¼ å°ç£è¯èª RPGï¼šå¹«æˆ‘å‚³èªª (Mobile Ver.)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Noto+Sans+TC:wght@400;700&display=swap');

        body {
            background-color: #1a1a1a;
            color: #fff;
            font-family: 'DotGothic16', 'Noto Sans TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            flex-direction: column;
            /* é˜²æ­¢æ‰‹æ©Ÿé›™æ“Šç¸®æ”¾ */
            touch-action: manipulation;
        }

        /* æƒæç·šç‰¹æ•ˆ */
        .scanlines {
            position: fixed;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 10;
        }

        /* === éŠæˆ²æ©Ÿæœ¬é«” (RWD æ ¸å¿ƒä¿®æ”¹) === */
        .game-boy {
            /* æ‰‹æ©Ÿç‰ˆè¨­å®šï¼šå¯¬åº¦ä½”æ»¿ 95%ï¼Œé«˜åº¦ä½”æ»¿ 90% */
            width: 95%;
            height: 90vh;
            /* é›»è…¦ç‰ˆè¨­å®šï¼šæœ€å¤§å¯¬åº¦é™åˆ¶ */
            max-width: 800px;
            max-height: 600px;
            
            background-color: #000;
            border: 4px solid #555;
            border-radius: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 20px rgba(0,255,0,0.15);
            overflow: hidden;
        }

        /* ç‹€æ…‹åˆ— */
        .status-bar {
            background: #222;
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #555;
            font-size: 1rem; /* æ‰‹æ©Ÿä¸Šå­—é«”é©ä¸­ */
            color: #0f0;
            flex-shrink: 0; /* é˜²æ­¢è¢«å£“ç¸® */
        }

        /* å ´æ™¯å€ */
        .scene-display {
            flex: 1.5; /* ä½”æ“šç•«é¢çš„æ¯”ä¾‹ */
            background-size: cover;
            background-position: center;
            position: relative;
            border-bottom: 4px solid #fff;
            image-rendering: pixelated;
            transition: background-image 0.5s ease;
        }
        
        /* NPC Emoji */
        .npc-sprite {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 120px; /* é›»è…¦ç‰ˆå¤§å° */
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8));
            animation: float 3s infinite ease-in-out;
        }

        /* å°è©±æ¡†å€ */
        .dialogue-box {
            flex: 2; /* å°è©±æ¡†ä½”æ¯”å¤§ä¸€é»ï¼Œé¿å…æ–‡å­—è¢«åˆ‡ */
            padding: 15px;
            background: #000;
            color: #fff;
            font-size: 1.1rem;
            line-height: 1.5;
            display: flex;
            flex-direction: column;
            /* å¦‚æœå…§å®¹å¤ªå¤šï¼Œå…è¨±æ²å‹• */
            overflow-y: auto; 
        }

        .typing-text {
            min-height: 60px;
            margin-bottom: 15px;
        }

        .typing-text::after {
            content: 'â–‹';
            animation: blink 0.8s infinite;
            color: #0f0;
        }

        /* é¸é …æŒ‰éˆ•å€ */
        .choices-container {
            display: grid;
            grid-template-columns: 1fr; /* æ‰‹æ©Ÿé è¨­ï¼šç›´æ’ï¼Œé¿å…æ“ åœ¨ä¸€èµ· */
            gap: 10px;
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
        }

        .rpg-btn {
            background: #111;
            border: 2px solid #fff;
            color: #fff;
            padding: 12px;
            font-family: inherit;
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            border-radius: 8px;
            transition: 0.2s;
            /* è®“æ–‡å­—è‡ªå‹•æ›è¡Œ */
            white-space: normal; 
            line-height: 1.3;
        }

        .rpg-btn:active {
            background: #fff;
            color: #000;
        }

        /* éŠæˆ²é–‹ç™¼è€… Credit - æ‰‹æ©Ÿå„ªåŒ–ç‰ˆ */
        .developer-credit {
            margin-top: 10px;
            color: #888;
            font-size: 0.9rem;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
            text-align: center;
            animation: glow 3s infinite alternate;
        }

        /* === åª’é«”æŸ¥è©¢ (é‡å°é›»è…¦è¢å¹•å„ªåŒ–) === */
        @media (min-width: 600px) {
            .choices-container {
                grid-template-columns: 1fr 1fr; /* é›»è…¦ç‰ˆæ”¹å›å…©æ¬„ */
            }
            .dialogue-box {
                font-size: 1.4rem;
            }
            .npc-sprite {
                font-size: 150px;
            }
        }

        /* === çµå±€ç•«é¢ === */
        .ending-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .ending-title {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: #f1c40f;
            text-shadow: 4px 4px 0 #c0392b;
        }

        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            text-align: center;
            padding: 20px;
        }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes float { 0%, 100% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-15px); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        @keyframes glow { from { color: #888; } to { color: #fff; text-shadow: 0 0 10px #0f0; } }

    </style>
</head>
<body>
    <div class="scanlines"></div>
    
    <div class="game-boy">
        <div id="start-overlay" onclick="startGame()">
            <h1 style="color: #0f0; font-size: 2em; margin-bottom: 20px;">é»æ“Šè¢å¹•é–‹å§‹</h1>
            <p style="color: #fff;">è«‹é–‹å•Ÿè²éŸ³ç²å¾—æœ€ä½³é«”é©— ğŸ”Š</p>
        </div>

        <div class="status-bar">
            <div>LV.<span id="level">1</span> å­¸ç”Ÿ</div>
            <div>HP:<span id="hp">100</span></div>
            <div>å°å‘³:<span id="exp">0</span></div>
        </div>

        <div class="scene-display" id="scene-bg" style="background-image: url('https://images.unsplash.com/photo-1554118811-1e0d58224f24?q=80&w=1000');">
            <div class="npc-sprite" id="npc-emoji">ğŸ¥¤</div>
        </div>

        <div class="dialogue-box">
            <div id="story-text" class="typing-text">ç³»çµ±è¼‰å…¥ä¸­...</div>
            <div class="choices-container" id="choices-area"></div>
        </div>

        <div class="ending-screen" id="ending-layer">
            <h1 class="ending-title" id="ending-title">çµå±€</h1>
            <p id="ending-desc" style="font-size: 1.2em; margin-bottom: 30px; line-height: 1.5;"></p>
            <button class="rpg-btn" onclick="location.reload()" style="width: 200px; text-align: center;">é‡æ–°å†’éšª</button>
        </div>

        <audio id="bgm" loop>
            <source src="https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/theme_01.mp3" type="audio/mp3">
        </audio>
    </div>

    <div class="developer-credit">éŠæˆ²é–‹ç™¼ï¼šæ—é´»ç‘è€å¸«</div>

<script>
    // === éŸ³æ•ˆåˆæˆå™¨ (Web Audio API) ===
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(freq, type, duration, time = 0, vol = 0.1) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + time);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime + time);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + time + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(audioCtx.currentTime + time);
        osc.stop(audioCtx.currentTime + time + duration);
    }

    // æ¨¡æ“¬é›œè¨Šï¼ˆç”¨æ–¼æŒè²ï¼‰
    function createNoiseBuffer() {
        const bufferSize = audioCtx.sampleRate * 2; // 2 seconds
        const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);
        for (let i = 0; i < bufferSize; i++) {
            data[i] = Math.random() * 2 - 1;
        }
        return buffer;
    }
    const noiseBuffer = createNoiseBuffer();

    function playApplause() {
        // æ¨¡æ“¬æŒè²ï¼šåˆ©ç”¨æ¿¾æ³¢å™¨éæ¿¾é›œè¨Š + å¤šé‡è§¸ç™¼
        const duration = 1.5;
        const noise = audioCtx.createBufferSource();
        noise.buffer = noiseBuffer;
        
        const filter = audioCtx.createBiquadFilter();
        filter.type = "lowpass";
        filter.frequency.value = 1000;

        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);

        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        noise.start();
        noise.stop(audioCtx.currentTime + duration);
    }

    const SFX = {
        type: () => playTone(800 + Math.random()*200, 'square', 0.05, 0, 0.05),
        
        // ç­”å°éŸ³æ•ˆï¼šå‹åˆ©è™Ÿè§’ (Fanfare) + æŒè²
        correct: () => {
            // ç¶éŸ³ C - E - G - High C
            playTone(523.25, 'square', 0.1, 0, 0.1);    // Do
            playTone(659.25, 'square', 0.1, 0.1, 0.1);  // Mi
            playTone(783.99, 'square', 0.1, 0.2, 0.1);  // Sol
            playTone(1046.50, 'square', 0.4, 0.3, 0.2); // High Do
            
            // å»¶é²ä¸€é»é»æ’­æ”¾æŒè²
            setTimeout(() => playApplause(), 200);
        },

        // ç­”éŒ¯éŸ³æ•ˆï¼šå¤±æ•—æ»‘éŸ³
        wrong: () => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            // é »ç‡å¾ 150Hz æ»‘è½åˆ° 50Hz
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(50, audioCtx.currentTime + 0.5);
            
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.5);
        }
    };

    // === éŠæˆ²é‚è¼¯ ===
    let hp = 100;
    let exp = 0;
    let isTyping = false;

    // å•Ÿå‹•éŠæˆ²
    function startGame() {
        const overlay = document.getElementById('start-overlay');
        overlay.style.opacity = '0';
        setTimeout(() => overlay.style.display = 'none', 500);
        
        if (audioCtx.state === 'suspended') audioCtx.resume();

        const bgm = document.getElementById('bgm');
        bgm.volume = 0.2;
        bgm.play().catch(e => console.log("Audio play failed", e));

        renderScene(0);
    }

    // åŠ‡æœ¬è³‡æ–™
    const storyLine = [
        {
            bg: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=1000",
            npc: "âœˆï¸",
            text: "ã€ç³»çµ±ã€‘\næ­¡è¿ä¾†åˆ°å°ç£ï¼é€™æ˜¯ä¸€å ´é—œæ–¼ã€Œå¹«æˆ‘ã€çš„ç”Ÿå­˜æŒ‘æˆ°ã€‚\nè«‹æ³¨æ„ä½ çš„ã€ŒHP (é¢å­)ã€ï¼Œæ­¸é›¶å°±å°·å°¬å›‰ï¼",
            choices: [{ text: "é–‹å§‹å†’éšª", next: 1, effect: null }]
        },
        {
            bg: "https://images.unsplash.com/photo-1521017432531-fbd92d768814?q=80&w=1000",
            npc: "ğŸ¥¤",
            text: "ã€é£²æ–™åº—ã€‘\nåº—å“¡ï¼šã€Œé£²æ–™å¥½å›‰ï¼å–ä¹‹å‰éº»ç…©å¹«æˆ‘æ–ä¸€ä¸‹å–”ï¼ã€",
            choices: [
                { text: "A. å¥½çš„ (è‡ªå·±æ–è‡ªå·±çš„é£²æ–™)", next: 2, effect: { hp: 0, exp: 20, msg: "åº—å“¡å¾®ç¬‘ã€‚\næ­£ç¢ºï¼é€™æ˜¯æœå‹™æ¥­çš„å®¢æ°£æŒ‡ä»¤ã€‚" } },
                { text: "B. æ‹¿éä¾†å¹«åº—å“¡æ–é£²æ–™", next: 2, effect: { hp: -30, exp: 0, msg: "åº—å“¡åš‡åˆ°...\nä»–ä¸æ˜¯è¦ä½ å¹«å¿™ä»–å•¦ï¼" } }
            ]
        },
        {
            bg: "https://images.unsplash.com/photo-1519494026892-80bbd2d6fd0d?q=80&w=1000",
            npc: "ğŸ‘©â€âš•ï¸",
            text: "ã€è¨ºæ‰€ã€‘\nè­·ç†å¸«ï¼šã€Œå…ˆç”Ÿæˆ‘å€‘è¦é‡é«”è„‚ï¼Œè«‹å¹«æˆ‘è„«ä¸€ä¸‹è¥ªå­ã€‚ã€",
            choices: [
                { text: "A. è¹²ä¸‹å»è„«è­·ç†å¸«çš„è¥ªå­", next: 3, effect: { hp: -60, exp: 0, msg: "è®Šæ…‹ï¼è­·ç†å¸«å°–å«ï¼\n(é¢å­å¤§æ -60)" } },
                { text: "B. è„«æ‰è‡ªå·±çš„è¥ªå­", next: 3, effect: { hp: 0, exp: 30, msg: "æ­£ç¢ºï¼\né€™æ˜¯ç‚ºäº†æ–¹ä¾¿æµç¨‹é€²è¡Œã€‚" } }
            ]
        },
        {
            bg: "https://images.unsplash.com/photo-1552566626-52f8b828add9?q=80&w=1000",
            npc: "ğŸ½ï¸",
            text: "ã€é¤å»³ã€‘\næœå‹™ç”Ÿï¼šã€Œå‰é¢è«‹å¹«æˆ‘ååœ¨ç¬¬ä¸‰æ¡Œå–”ã€‚ã€",
            choices: [
                { text: "A. æ‰¶æœå‹™ç”Ÿå»åç¬¬ä¸‰æ¡Œ", next: 4, effect: { hp: -50, exp: 0, msg: "æœå‹™ç”Ÿï¼šå…ˆç”Ÿä½ å¹¹å˜›...\n(å°·å°¬äº† -50)" } },
                { text: "B. è‡ªå·±èµ°åˆ°ç¬¬ä¸‰æ¡Œåä¸‹", next: 4, effect: { hp: 0, exp: 20, msg: "å…§è¡Œï¼\né€™æ˜¯å ´åŸŸå”èª¿çš„ç¦®è²Œç”¨æ³•ã€‚" } }
            ]
        },
        {
            bg: "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?q=80&w=1000",
            npc: "ğŸ‘µ",
            text: "ã€è·¯é‚Šã€‘\né˜¿å©†æ¬ç®±å­ï¼šã€Œå¹´è¼•äººï¼Œå¹«æˆ‘æ¬ä¸€ä¸‹å¥½å—ï¼Ÿã€",
            choices: [
                { text: "A. ç«™è‘—ä¸å‹• (ä»¥ç‚ºåªæ˜¯å®¢æ°£è©±)", next: 99, effect: { hp: -20, exp: 0, msg: "é˜¿å©†ç”Ÿæ°£äº†ï¼\né€™æ˜¯çœŸçš„æ±‚åŠ©ï¼" } },
                { text: "B. é¦¬ä¸Šå¹«å¿™æ¬", next: 99, effect: { hp: 10, exp: 30, msg: "é˜¿å©†æ„Ÿè¬ä½ ï¼\né€™å°±æ˜¯å°ç£äººæƒ…å‘³ï¼" } }
            ]
        }
    ];

    function renderScene(index) {
        if (hp <= 0) { showEnding("bad"); return; }
        if (index === 99) { determineEnding(); return; }

        const data = storyLine[index];
        document.getElementById("scene-bg").style.backgroundImage = `url('${data.bg}')`;
        document.getElementById("npc-emoji").innerText = data.npc;
        document.getElementById("choices-area").innerHTML = "";

        const textBox = document.getElementById("story-text");
        textBox.innerHTML = "";
        let i = 0;
        isTyping = true;

        function typeWriter() {
            if (i < data.text.length) {
                const char = data.text.charAt(i);
                textBox.innerHTML += char === '\n' ? '<br>' : char;
                if(i % 3 === 0) SFX.type(); 
                i++;
                setTimeout(typeWriter, 50);
            } else {
                isTyping = false;
                renderChoices(data.choices);
            }
        }
        typeWriter();
    }

    function renderChoices(choices) {
        const area = document.getElementById("choices-area");
        choices.forEach(choice => {
            const btn = document.createElement("button");
            btn.className = "rpg-btn";
            btn.innerText = choice.text;
            btn.onclick = () => handleChoice(choice);
            area.appendChild(btn);
        });
    }

    function handleChoice(choice) {
        if (isTyping) return;

        if (choice.effect) {
            hp += choice.effect.hp;
            exp += choice.effect.exp;
            if (hp > 100) hp = 100;
            updateStats();

            if (choice.effect.hp < 0) {
                SFX.wrong(); // æ’­æ”¾å¤±æ•—éŸ³æ•ˆ
                alert("âŒ " + choice.effect.msg);
            } else {
                SFX.correct(); // æ’­æ”¾å‹åˆ©éŸ³æ•ˆ + æŒè²
                // é€™è£¡ä¸ä½¿ç”¨ alertï¼Œä»¥å…ä¸­æ–·éŸ³æ•ˆçš„çˆ½æ„Ÿï¼Œç›´æ¥é€²ä¸‹ä¸€é—œï¼Œæˆ–ç”¨è‡ªè¨‚ Overlay
                alert("â­• " + choice.effect.msg); 
            }
        }
        renderScene(choice.next);
    }

    function updateStats() {
        const hpEl = document.getElementById("hp");
        hpEl.innerText = hp;
        document.getElementById("exp").innerText = exp;
        if (hp < 50) hpEl.style.color = "#e74c3c";
        else hpEl.style.color = "#0f0";
    }

    function determineEnding() {
        if (exp >= 80) showEnding("master");
        else showEnding("normal");
    }

    function showEnding(type) {
        const screen = document.getElementById("ending-layer");
        const title = document.getElementById("ending-title");
        const desc = document.getElementById("ending-desc");
        screen.style.display = "flex";

        if (type === "master") {
            title.innerText = "ğŸ† å°å‘³å¤§å¸«";
            title.style.color = "#f1c40f";
            desc.innerHTML = "æ—é´»ç‘è€å¸«èªè­‰ï¼š<br>ä½ å·²ç¶“å®Œå…¨æŒæ¡å°ç£è¯èªçš„ç²¾é«“äº†ï¼";
            SFX.correct();
        } else if (type === "bad") {
            title.innerText = "ğŸ’€ ç¤¾æœƒæ€§æ­»äº¡";
            title.style.color = "#e74c3c";
            desc.innerHTML = "å› ç‚ºèª¤è§£ã€Œå¹«æˆ‘ã€ï¼Œä½ é€ æˆäº†å¤ªå¤§çš„å°·å°¬...<br>è«‹é‡æ–°ä¿®ç·´ï¼";
            SFX.wrong();
        } else {
            title.innerText = "ğŸ˜ æ™®é€šéŠå®¢";
            desc.innerHTML = "é‚„ä¸éŒ¯ï¼Œä½†é‚„æœ‰é€²æ­¥ç©ºé–“ï¼";
        }
    }
</script>
</body>
</html>
